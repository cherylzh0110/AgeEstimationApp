<html>
  <head>
      <meta charset="utf-8">
    <title>AgeEstimationApp</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!--   <div id="home">
  <nav class="navbar navbar-expand-md navbar-light bg-light sticky-top">
  <div class="container-fluid">
  <a class="navbar-brand" href="#"><img src="img/logo.png"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu">
  <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="menu">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item active">
  <a class="nav-link" href="#home">Home</a>
      </li>
      <li class="nav-item">
  <a class="nav-link" href="#about">About</a>
      </li>
    <li class="nav-item">
  <a class="nav-link" href="#tech">Tech</a>
    </li>
    </ul>
  </div>
</div>
</nav>
</div> -->

  

    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:400i" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">

    <script src="js/main_system.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
    <link class="jsbin" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    
    <meta charset=utf-8 />
    <script src="js/main_system.js"></script>

    <script type="text/javascript">
    window.onload = doStuff;
    function doStuff() {
      var table=document.getElementById("table");
      table.style.display='none';
      var loading=document.getElementById("loading");
      loading.style.display='none';
        }

    function previewFile(){
       var preview = document.querySelector('img'); //selects the query named img
       var file    = document.querySelector('input[type=file]').files[0]; //same as here
       var reader  = new FileReader();
               reader.onloadend = function () {
                   image_url = reader.result
                   preview.src = image_url;
                   console.log(image_url)
               }
               if (file) {
                   reader.readAsDataURL(file); //reads the data as a URL
               } else {
                   preview.src = "";
               }
          }

    // function classify_system() {
    //           table.innerHTML = "" ;
    //           loading.style.display='block';
    //           var url="classify_system?imageurl=" + image_url;
    //           $.get(url, function(data, status){
    //             table.style.display='block';
    //             loading.style.display='none';
    //             for(var i=data.results.length-1;i>=0;i--){
    //               var row = table.insertRow(0);
    //               var cell1 = row.insertCell(0);
    //               var cell2 = row.insertCell(1);
    //               cell1.innerHTML = data.results[i].class_name;
    //               cell2.innerHTML = data.results[i].score;
    //             }
    //             var row = table.insertRow(0);
    //             var cell1 = row.insertCell(0);
    //             var cell2 = row.insertCell(1);
    //             cell1.innerHTML = "<b>Class Name</b>";
    //             cell2.innerHTML = "<b>Score</b>";
    //           });
    //       };
    </script>
  </head>
  

  <body id="main">
    <div class="container">
      <div class="jumbotron">
      <h1>Welcome To Age Estimation Web Application</h1>
      <p class="lead">Upload your photo to get your age estimation result</p>
      <a href="/video"><button type="button" class="btn btn-warning btn=lg">Live Stream
                </button></a>
                <a href="/about"><button type="button" class="btn btn-warning btn=lg">Learn Model
                </button></a>
      </div>
    </div>



    <div class="container">

      <div>
        <input type="file" onchange="previewFile()"><br>
      </div>

          <div class="input-group">
            <span class="input-group-btn">
              <button id="btn_search" class="btn btn-success btn-lg" onclick="classify_system();" type="button">GO !</button>
            </span>
          </div>

          <div>
           <!--  <img src="" class="img-responsive" alt="background.jpg"> -->
          </div>

          <div class="col-lg-6">
            <div id="loading"> Processing Image...</div>
             <table id="table" class="table table-striped">
            </table>
            <div id="piechart" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div> 
            <script>

         
        function classify_system(){
          table.innerHTML = "" ;
              loading.style.display='block';
              var url="classify_system?imageurl=" + image_url;
              $.get(url, function(data, status){
                table.style.display='none';
                loading.style.display='none';
                var test_data = data.results
                Highcharts.chart('piechart', {
          chart: {
                  plotBackgroundColor: null,
                  plotBorderWidth: null,
                  plotShadow: false,
                  type: 'pie'
                  },
          title: {
                  text: 'Prediction Results'
                  },
          tooltip: {
                  pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                  },
          plotOptions: {
                    pie: {
                          allowPointSelect: true,
                          cursor: 'pointer',
                          dataLabels: {
                          enabled: true,
                          format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                          style: {
                              color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                  }
                                      }
                            }                       
                          },
          series: [{
                name: 'Age Range Probability',
                colorByPoint: true,
                data: data.results
                    }]
                  })
              })
            };
              </script>

          </div>
        </div>
      </div>
    </div>
    <!-- <footer><center> Deep Learning embedded Age Estimation Application: Hong Zhang, Qijie Li  </center></footer> -->
  </body>
    <script src="js/main_system.js"></script>
</html>